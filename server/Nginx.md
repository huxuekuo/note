# Nginx



## 负载均衡(6种方式)

​		分摊到多个操作单元上执行,负载均衡保证将后端所有服务器都将性能充分发挥,从而保证服务器集群的整体性能优化,

### 	源地址hash算法

​			根据客户端IP地址利用hash函数计算出来的值,对服务器列表大小进行取模,得到的结果就是服务器的序号,如果服务器列表大小不发生变化那么他每次都会映射到同一台服务器上,间接保证了session

~~~ nginx
upstream guwenjie_http {
				ip_hash; 
        server **.***.***.***:8855;
        server **.***.***.***:8811;
}
~~~



### 	随机法

​		根据后端服务器列表随机选取一台服务器

### 	轮询法

​			他将请求按照顺序分配到服务器端,他不关注服务器的连接数和当前系统的负载

### 	加权轮询法

​			加权的感觉就是优先级,服务器配置好点的优先级调的高一点

### 	加权随机分配法

​			也就在随机分配的基础上加上一个优先级

~~~ nginx

~~~



### 	最小连接数法

​			根据后端服务的连接情况选取一台连接最少的服务器来响应当前连接

~~~  nginx
upstream guwenjie_http {
        server **.***.***.***:8855;
        server **.***.***.***:8811;
        fair; 
}
~~~





## 健康检查



nginx有自己的健康检查工具proxy_next_upstream但是这个有一点他是先把请求会发给故障机然后在发给别的服务器,这样就浪费了一个请求



可以使用淘宝出的nginx_upstream_check_module用来检测后端server的健康信息,如果后端服务器不可用,则所有请求将不发到此服务器上



